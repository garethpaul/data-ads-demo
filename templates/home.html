{% extends "base.html" %}
{% load tags %}
{% load humanize %}

{% block title %}Twitter Reviews{% endblock %}

{% block content %}

<script language="JavaScript1.2">

$(document).ready(function(){

{% if columns %}
{% autoescape off %}

var args = {
    bindto: '#chart',
    data: {
        x: 'x',
//        xFormat: '%Y%m%d', // 'xFormat' can be used as custom format of 'x'
        columns: {{columns}}
    },
    axis: {
        x: {
            type: 'timeseries',
            tick: {
                format: '%Y-%m-%d'
            }
        }
    }
};
var chart = c3.generate(args);

{% endautoescape %}
{% endif %} 

});
</script>

<div class="row">
<div class="col-md-offset-2 col-md-8">

<form method="GET" action="/">

<div class="row top-buffer">
  <div class="col-md-10">
    <input type="text" class="form-control" name="query" id="query" placeholder="(Walking Dead) OR #WalkingDead OR #TheWalkingDead has:media" value="{{query}}">
    <p class="help-block">For query syntax, read the <a href="http://support.gnip.com/apis/powertrack/rules.html" target="_target">GNIP Search API Reference</a></p>
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary">Search</button>
  </div>
</div>

</form>

{% if query %}

<h3>Activity Volume</h3>

<p class="help-block">Tweet count: {{total|intcomma}}</p>

<div class="row volume">

	<div class="col-md-12">
		<div id="chart">Please select a data source and click "Submit".</div>
	</div>

</div>

<div class="row">
  <div class="col-md-12">

	<p class="pull-right">Expand your search by adding <a href="#" data-toggle="collapse" data-target="#collapseOne">related terms</a>.
	</p>

  </div>
</div>

<div class="accordion" id="accordion2">
  <div class="accordion-group">
    <div id="collapseOne" class="accordion-body collapse">
      <div class="accordion-inner">

		<br>
		
		<table class="table table-striped table-condensed">
		<tr>
		<th></th>
		<th>Term</th>
		<th>Mentions (100)</th>
		<th>Mentions %</th>
		<th>Activities (100)</th>
		<th>Activities %</th>
		</tr>
		
		{% for f in frequency %}
		<tr>
		<td><input type="checkbox" value="{{f.4}}" class="term"></td>
		<td>{{f.4}}</td>
		<td>{{f.0}}</td>
		<td>{{f.1|percentage}}</td>
		<td>{{f.2}}</td>
		<td>{{f.3|percentage}}</td>
		</tr>
		{% endfor %}
		
		</table>

      </div>
    </div>
  </div>
</div>

{% endif %}

</div>
</div>

<div class="row">
<div class="col-md-offset-1 col-md-10">

{% if tweets %}

<h3>Activity</h3>

<p class="help-block">Last {{tweets|length}}</p>

<div id="tweets">

{% for t in tweets %}

<article class="white-panel">
	<blockquote class="twitter-tweet" lang="en"><p>{{t.body}}</p>&mdash;{{t.actor.displayName}} ({{t.actor.preferredUsername}})<a href="https://twitter.com/{{t.object.link}}">{{t.object.postedTime}}</a></blockquote>
</article>

{% endfor %}

</div>

{% endif %}


</div>
</div>

<script>

window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);
 
  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };
 
  return t;
}(document, "script", "twitter-wjs"));

$('#tweets').pinterest_grid({
	no_columns: 3,
	padding_x: 10,
	padding_y: 10,
	margin_bottom: 50,
	single_column_breakpoint: 700
});

</script>

{% endblock %}