{% extends "base.html" %}
{% load tags %}
{% load humanize %}

{% block title %}Ads Accounts{% endblock %}

{% block content %}
<div class="row">
  <h4><a href=".../ads/audiences">Audiences</a></h4>

  <!-- Setup Table to consume Ads Api -->
  <table class="table" style="width:80%">
    <thead>
      <tr>
        <th>Audience Bucket</th>
        <th>Search Query</th>
        <th></th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody class="table-data">
    </tbody>
  </table>
</div>
<script>
<<<<<<< HEAD
$(document).ready(function () {
  var audienceList = localStorage.getItem("audienceList");
  if (audienceList != null) {
    var json_list = JSON.parse(audienceList);
    for (var i=0; i < json_list.length; i++) {
        var item = json_list[i]
        tr = $('<tr/>');
        tr.append("<td>" + item["location"] + "</td>");
        tr.append("<td>" + item["query"] + "</td>");
        tr.append("<td><button class='ta btn btn-danger' data-id='" + item['location'] + "'>Target Audience</button>")
        $(".table").append(tr);
    }
  }
}


function displayAudiences(){

  $(".table-data").html("");

  var audienceList = localStorage.getItem("audienceList");
  if (audienceList != null) {

    var json_list = JSON.parse(audienceList);
    for (var i=0; i < json_list.length; i++) {
        var item = json_list[i];

        if (item){
          tr = $('<tr/>');
          tr.append("<td>" + item["location"] + "</td>");
          tr.append("<td>" + item["query"] + "</td>");
          td2 = $('<td/>');
          td2.append("<button class='ta btn btn-sm btn-danger' data-id='" + item['location'] + "'>Target Audience</button> ")
          td2.append("<button class='ta-del btn btn-sm btn-primary' data-id='" + item['location'] + "'>Delete</button>")
          tr.append(td2)
          $(".table").append(tr);
        }
    }
  }

}

$(document).ready(function () {

  displayAudiences();

  $(document).on("click", ".ta", function(){
    var bucket_location = $(this).data("id");
    // Set bucket to local storage and then send the user a modal
    localStorage.setItem("selected_bucket") = bucket_location
  });


  $(document).on("click", ".ta-del", function(){
    var bucket_location = $(this).data("id");

    var audienceList = localStorage.getItem("audienceList");
    if (audienceList != null) {

      var json_list = JSON.parse(audienceList);

      for (var i=0; i < json_list.length; i++) {
        var item = json_list[i]
        if (!item || item["location"] == bucket_location){
            delete json_list[i]
        }
      }

      localStorage.setItem("audienceList", JSON.stringify(json_list))

    }

    displayAudiences();

  });
});


</script>

{% endblock %}
